<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0,minimal-ui">
<title>webpack [4] 的前世今生和模块化原理 |
    PCDotFan</title>
<link rel="stylesheet" href="/styles/main.css">
<link rel="shortcut icon" href="https://blog.g4.cx/favicon.ico?v=1580055175294">
<link href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap" rel="stylesheet">
<script src="https://cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>
  </head>
  <body>
    <div class="surface-content">
  <header class="site-header">
      <div class="container">
          <div class="topNav">
              <ul class="subnav-ul">
                
                  
                    <li><a href="/" aria-current="page">首页</a></li>
                  
                
                  
                    <li><a href="https://blog.g4.cx/tags/music" aria-current="page">音乐</a></li>
                  
                
                  
                    <li><a href="/post/about" aria-current="page">关于</a></li>
                  
                
              </ul>
              <div class="social-container">
                
                  
                
                  
                
                  
                
                  
                
                  
                
              </div>
          </div>
          <h1 class="site-title">
              <a href="https://blog.g4.cx">PCDotFan</a>
          </h1>
          <p class="site-description">A straight jacket for your mind.</p>
      </div>
  </header>
    <main class="main-content">
      <section class="block-content container">
        
        <h2 class="block-title">
          webpack [4] 的前世今生和模块化原理
        </h2>
        <div class="block-postMetaWrap">
          <i class="dot">•</i>
          <time>2020-01-26</time>
          
        </div>
        <div class="grap">
          <h2 id="why-webpack">WHY WEBPACK ?</h2>
<!-- 
在前端还没有发展得这么迅速的十年前——要知道，JavaScript 真的只是 **Script**：只能依赖 `<script>` 标签内嵌在 HTML 当中使用。及时
webpack作为一个构建工具，解决了前端代码缺少模块化能力的问题。我们写的代码，经过webpack构建和包装之后，能够在浏览器以模块化的方式运行。 -->
<h2 id="从-indexjs-打包开始">从 index.js 打包开始</h2>
<p>先创建两个简单的文件 <code>index.js</code> 和 <code>nav.js</code>，分别代表「入口文件」和「依赖模块」，看看通过 webpack 是怎么实现模块化的。</p>
<h3 id="indexjs"><code>index.js</code>：</h3>
<pre><code class="language-javascript">import nav from './nav'
console.log(nav)
</code></pre>
<h3 id="navjs"><code>nav.js</code></h3>
<pre><code class="language-javascript">export default 'nav'
</code></pre>
<p>在正确引入 <code>webpack</code> 后，直接执行 <code>npm run webpack -- --mode development</code> 即可生成打包后的文件 <code>dist/main.js</code>。</p>
<h3 id="mainjs"><code>main.js</code></h3>
<p>在 <code>development</code> 模式下生成的文件附带有详细注释，总体可简化为两个 IIFE：</p>
<pre><code class="language-javascript">// webpackBootstrap
(function(modules) { 
    var installedModules = {};
    // ...
})

//
({
/***/ &quot;./src/index.js&quot;: (function(module, __webpack_exports__, __webpack_require__) {...}),
/***/ &quot;./src/nav.js&quot;: (function(module, __webpack_exports__, __webpack_require__) {...})
});
</code></pre>
<h3 id="webpackbootstrap">webpackBootstrap</h3>
<pre><code class="language-javascript">(function(modules) { // webpackBootstrap
 	// 模块缓存，先看下面
 	var installedModules = {};

 	// 主要执行引入的函数
 	function __webpack_require__(moduleId) {

 		// 检查是否已经导入了该模块
 		if(installedModules[moduleId]) {
            // 返回模块的导出（module.exports）
 			return installedModules[moduleId].exports;
 		}
 		// 如果还没，就先创建一个对象记录一下 (并写入模块缓存)
 		var module = installedModules[moduleId] = {
 			i: moduleId, // i =&gt; id
 			l: false, // l =&gt; loaded 标记是否已导入
 			exports: {} // 模块的导出
 		};

 		// call 模块的函数
 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

 		// 标记一下我加载了
 		module.l = true;

 		// 返回模块的导出
 		return module.exports;
 	}


 	// 给 __webpack_require__ 暴露所有模块 (__webpack_modules__)
 	__webpack_require__.m = modules;

 	// 暴露模块缓存
 	__webpack_require__.c = installedModules;

 	// define getter function for harmony exports
 	__webpack_require__.d = function(exports, name, getter) {
 		if(!__webpack_require__.o(exports, name)) {
 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
 		}
 	};

 	// 给 exports 定义 __esModule （用在 Babel 上）
 	__webpack_require__.r = function(exports) {
 		if(typeof Symbol !== 'undefined' &amp;&amp; Symbol.toStringTag) {
 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
 		}
 		Object.defineProperty(exports, '__esModule', { value: true });
 	};

 	// create a fake namespace object
 	// mode &amp; 1: value is a module id, require it
 	// mode &amp; 2: merge all properties of value into the ns
 	// mode &amp; 4: return value when already ns object
 	// mode &amp; 8|1: behave like require
 	__webpack_require__.t = function(value, mode) {
 		if(mode &amp; 1) value = __webpack_require__(value);
 		if(mode &amp; 8) return value;
 		if((mode &amp; 4) &amp;&amp; typeof value === 'object' &amp;&amp; value &amp;&amp; value.__esModule) return value;
 		var ns = Object.create(null);
 		__webpack_require__.r(ns);
 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
 		if(mode &amp; 2 &amp;&amp; typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
 		return ns;
 	};

 	// getDefaultExport function for compatibility with non-harmony modules
 	__webpack_require__.n = function(module) {
 		var getter = module &amp;&amp; module.__esModule ?
 			function getDefault() { return module['default']; } :
 			function getModuleExports() { return module; };
 		__webpack_require__.d(getter, 'a', getter);
 		return getter;
 	};

 	// Object.prototype.hasOwnProperty.call
 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };

 	// __webpack_public_path__
 	__webpack_require__.p = &quot;&quot;;


 	// Load entry module and return exports
 	return __webpack_require__(__webpack_require__.s = &quot;./src/index.js&quot;);
 })
</code></pre>

        </div>
        <div class="tag-list">
          
        </div>
          <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '6a2718ba6556a741c645',
    clientSecret: 'c33a68c8747fe1f16167cfa8167e74292b596f6f',
    repo: 'pcdotfan.github.io',
    owner: 'pcdotfan',
    admin: ['pcdotfan'],
    id: location.pathname,      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>
   
      </section>
    </main>
        <footer class="site-footer">
        <p class="container">
            Made with
<span class="cute iconfont icon-heart"></span>
<span class="sep"></span>
Designed by
<a href="https://fatesinger.com" target="_blank">bigfa</a>
<span class="sep"></span>
Proudly published by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
        </p>
    </footer>
</div>
<script>
    hljs.initHighlightingOnLoad()
</script>
      
  </body>
</html>
